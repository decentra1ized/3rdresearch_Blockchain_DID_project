function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r,t,i=require("elliptic"),n=require("did-jwt/lib/Digest"),o=e(require("uport-did-resolver")),a=e(require("ethr-did-resolver")),c=e(require("https-did-resolver")),s=e(require("uport-lite")),u=require("mnid"),d=require("did-jwt");!function(e){e.Function="function",e.Event="event",e.Constructor="constructor",e.Fallback="fallback"}(r||(r={})),function(e){e.Pure="pure",e.View="view",e.NonPayable="nonpayable",e.Payable="payable"}(t||(t={}));var l,p=function(e,r){for(var t=e.name+"(",i=e.inputs||[],n=0;n<i.length;n++){var o=i[n],a=o.type+" ";t+=a+="string"===o.type?'"'+r[n]+'"':""+r[n],i.length-1!==n&&(t+=", ")}return t+")"},f=function(e){return function(t){return{at:function(i){var n={};return function(e){return e.filter(function(e){return e.type===r.Function&&e.name&&!e.constant})}(t).forEach(function(r){r.name&&(n[r.name]=function(){var t={},n=[].slice.call(arguments),o=(r.inputs||[]).length;(function(e){if("object"!=typeof e)return!1;if(0===Object.keys(e).length)return!0;for(var r=0,t=["from","to","data","value","gasPrice","gas"];r<t.length;r+=1)if(t[r]in e)return!0;return!1})(n[o])&&(t=n.splice(o,1)[0]);var a=Object.assign({},t,{to:i,function:p(r,n)});return e?e(a,n[n.length-1]):a})}),Object.assign({},n,{abi:t,address:i})}}}},v=new i.ec("secp256k1");!function(e){e.DISCLOSURE_REQUEST="shareReq",e.DISCLOSURE_RESPONSE="shareResp",e.TYPED_DATA_SIGNATURE_REQUEST="eip712Req",e.VERIFICATION_SIGNATURE_REQUEST="verReq",e.ETH_TX_REQUEST="ethtx",e.PERSONAL_SIGN_REQUEST="personalSigReq"}(l||(l={}));var h=function(e){var r,t=e.did,i=e.address,l=e.privateKey,p=e.signer,f=e.networks,h=e.registry,y=e.ethrConfig;if(p?this.signer=p:l&&(this.signer=d.SimpleSigner(l)),t)this.did=t;else if(i)u.isMNID(i)&&(this.did="did:uport:"+i),i.match("^0x[0-9a-fA-F]{40}$")&&(this.did="did:ethr:"+i);else if(l){var g=v.keyFromPrivate(l),E=n.toEthereumAddress(g.getPublic("hex"));this.did="did:ethr:"+E}o(h||s({networks:f?(r=f,Object.keys(r).forEach(function(e){var t=r[e];if("object"!=typeof t)throw new Error("Network configuration object required");["registry","rpcUrl"].forEach(function(e){if(!t.hasOwnProperty(e))throw new Error("Malformed network config object, object must have '"+e+"' key specified.")})}),r):{}})),a(y||{}),c()};h.createIdentity=function(){var e=v.genKeyPair(),r=e.getPublic("hex"),t=e.getPrivate("hex");return{did:"did:ethr:"+n.toEthereumAddress(r),privateKey:t}},h.prototype.signJWT=function(e,r){return this.did&&this.signer?d.createJWT(e,{issuer:this.did,signer:this.signer,alg:this.did.match("^did:uport:")||u.isMNID(this.did)?"ES256K":"ES256K-R",expiresIn:r}):Promise.reject(new Error("No Signing Identity configured"))},h.prototype.createDisclosureRequest=function(e,r){void 0===e&&(e={}),void 0===r&&(r=600);var t={};if(e.requested&&(t.requested=e.requested),e.verified&&(t.verified=e.verified),e.claims&&(t.claims=e.claims),e.notifications&&(t.permissions=["notifications"]),e.callbackUrl&&(t.callback=e.callbackUrl),e.networkId&&(t.net=e.networkId),e.rpcUrl){if(!e.networkId)return Promise.reject(new Error("rpcUrl was specified but no networkId"));t.rpc=e.rpcUrl}if(e.vc&&(t.vc=e.vc),e.exp&&(t.exp=e.exp),e.accountType){if(!(["general","segregated","keypair","none"].indexOf(e.accountType)>=0))return Promise.reject(new Error("Unsupported accountType "+e.accountType));t.act=e.accountType}return this.signJWT(Object.assign({},t,{type:l.DISCLOSURE_REQUEST}),e.exp?void 0:r)},h.prototype.createVerification=function(e){return this.signJWT({sub:e.sub,claim:e.claim,exp:e.exp,vc:e.vc,callbackUrl:e.callbackUrl})},h.prototype.createVerificationSignatureRequest=function(e,r){return this.signJWT({unsignedClaim:e,sub:r.sub,riss:r.riss,aud:r.aud,vc:r.vc,callback:r.callbackUrl,type:l.VERIFICATION_SIGNATURE_REQUEST},r.expiresIn)},h.prototype.createTypedDataSignatureRequest=function(e,r){void 0===r&&(r={});var t=r.from,i=r.net,n=r.callback;try{for(var o=0,a=["types","primaryType","message","domain"];o<a.length;o+=1){var c=a[o];if(!e[c])throw new Error("Invalid EIP712 Request, must include '"+c+"'")}return Promise.resolve(this.signJWT({typedData:e,from:t,net:i,callback:n,type:l.TYPED_DATA_SIGNATURE_REQUEST}))}catch(e){return Promise.reject(e)}},h.prototype.createPersonalSignRequest=function(e,r){return void 0===r&&(r={}),this.signJWT({data:e,from:r.from,net:r.net,callback:r.callback,type:l.PERSONAL_SIGN_REQUEST})},h.prototype.createTxRequest=function(e,r){void 0===r&&(r={});var t=r.callbackUrl,i=r.exp;void 0===i&&(i=600);var n=r.networkId,o=r.label,a={};return t&&(a.callback=t),n&&(a.net=n),o&&(a.label=o),this.signJWT(Object.assign({},a,e,{type:l.ETH_TX_REQUEST}),i)},h.prototype.createDisclosureResponse=function(e,r){void 0===e&&(e={}),void 0===r&&(r=600);try{var t=this;function i(){return t.signJWT(Object.assign({},e,{type:l.DISCLOSURE_RESPONSE}),r)}var n=function(){if(e.req)return Promise.resolve(d.verifyJWT(e.req)).then(function(r){r.issuer&&(e.aud=r.issuer)})}();return n&&n.then?n.then(i):i()}catch(e){return Promise.reject(e)}},h.prototype.processDisclosurePayload=function(e){var r=e.doc,t=e.payload;try{var i=this,n=t.own;void 0===n&&(n={});var o=t.capabilities;void 0===o&&(o=[]);var a=t.nad,c=t.dad,s=t.iss,l=t.boxPub,p=t.verified,f=function(e,r){var t={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&-1===r.indexOf(i)&&(t[i]=e[i]);return t}(t,["own","capabilities","aud","req","iat","exp","type","nad","dad","iss","boxPub","verified"]),v=r.uportProfile;void 0===v&&(v={});var h=Object.assign({},{did:s,boxPub:l},n,v,f);c&&(h.deviceKey=c),a&&(h.mnid=a,h.address=u.decode(a).address),1===o.length&&(h.pushToken=o[0]);var y=function(){if(p){var e=[],r=p.map(function(r){return d.verifyJWT(r,{audience:i.did}).catch(function(){return e.push(r),Promise.resolve(void 0)})});return Promise.resolve(Promise.all(r)).then(function(r){var t=[];r.forEach(function(e){e&&t.push(Object.assign({},e.payload,{jwt:e.jwt}))}),h.verified=t,h.invalid=e})}}();return y&&y.then?y.then(function(){return h}):h}catch(e){return Promise.reject(e)}},h.prototype.authenticateDisclosureResponse=function(e,r){try{var t=this;return Promise.resolve(d.verifyJWT(e,{audience:t.did,callbackUrl:r,auth:!0})).then(function(e){var r=e.payload,i=e.doc;if(r.req)return Promise.resolve(d.verifyJWT(r.req,{audience:t.did})).then(function(e){var n=e.payload;if(n.type!==l.DISCLOSURE_REQUEST)throw new Error("Challenge payload type invalid: "+n.type);return t.processDisclosurePayload({payload:r,doc:i})});throw new Error("Challenge was not included in response")})}catch(e){return Promise.reject(e)}},h.prototype.verifyDisclosure=function(e){try{var r=this;return Promise.resolve(d.verifyJWT(e,{audience:r.did})).then(function(e){return r.processDisclosurePayload({payload:e.payload,doc:e.doc})})}catch(e){return Promise.reject(e)}},h.prototype.contract=function(e){var r=this;return f(function(e,t){return e.function&&(e.fn=e.function),delete e.function,r.createTxRequest(e,t)}.bind(this))(e)};var y=d.SimpleSigner,g=f,E={Credentials:h,SimpleSigner:y,ContractFactory:g};exports.Credentials=h,exports.SimpleSigner=y,exports.ContractFactory=g,exports.default=E;
//# sourceMappingURL=index.js.map
